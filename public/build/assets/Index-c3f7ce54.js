import{X as J,r as l,a as s,j as e,S as O,R as Z,x as ee,A as g,F as ae}from"./app-f1a8b610.js";import{A as se}from"./AuthenticatedLayout-71f34ef1.js";import{r as E,F as re,t as te,c as $,p as ne,q as le,i as ie,A as D,B as j,f as de,C as oe}from"./index-c4182c7c.js";import{M as A}from"./Modal-6072cb3e.js";import{B as h}from"./Button-9036e8a9.js";import"./Toater-ded24001.js";import"./index-60594ba4.js";import"./index-e934185f.js";import"./proxy-6154b2ea.js";function ve({auth:ce}){const{users:n,roles:M,categories:B,filters:b}=J().props,[I,N]=l.useState(!1),[v,p]=l.useState(!1),[i,w]=l.useState(!1),[c,k]=l.useState(null),[z,me]=l.useState(null),[_,T]=l.useState(null),[C,S]=l.useState((b==null?void 0:b.search)||""),[F,x]=l.useState(!1),[d,f]=l.useState({name:"",email:"",role_id:"",password:"",password_confirmation:"",category_ids:[]}),[r,P]=l.useState({});function U(a,t){let o;return function(...u){clearTimeout(o),o=setTimeout(()=>{a.apply(this,u)},t)}}const K=l.useCallback(U(a=>{g.get("/super-admin/users",{search:a},{preserveState:!0,replace:!0,onFinish:()=>x(!1)})},500),[]),L=a=>{const t=a.target.value;S(t),x(!0),K(t)},R=()=>{S(""),x(!0),g.get("/super-admin/users",{},{preserveState:!0,replace:!0,onFinish:()=>x(!1)})};l.useEffect(()=>{v||(f({name:"",email:"",role_id:"",password:"",password_confirmation:"",category_ids:[]}),P({}),w(!1),k(null))},[v]),l.useEffect(()=>{var a;i&&c&&f({name:c.name,email:c.email,role_id:c.role_id,password:"",password_confirmation:"",category_ids:((a=c.managedCategories)==null?void 0:a.map(t=>t.id))||[]})},[i,c]);const W=()=>{g.delete(`/super-admin/users/${z}`,{preserveScroll:!0,onSuccess:()=>{N(!1)}})},q=a=>{T(_===a?null:a)},H=a=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(a).toLocaleDateString("id-ID",t)},Q=()=>{p(!0),w(!1)},X=a=>{k(a),w(!0),p(!0)},m=a=>{const{name:t,value:o}=a.target;f(u=>({...u,[t]:o}))},V=a=>{const{value:t,checked:o}=a.target;f(u=>{let y=[...u.category_ids];return o?y.push(parseInt(t)):y=y.filter(G=>G!==parseInt(t)),{...u,category_ids:y}})},Y=()=>{const a=i?`/super-admin/users/${c.id}`:"/super-admin/users";g[i?"put":"post"](a,d,{preserveScroll:!0,onSuccess:()=>{p(!1)},onError:o=>{P(o)}})};return console.log(n),s(se,{children:[e(O,{title:"Kelola Pengguna"}),e("div",{className:"",children:s("div",{children:[s("div",{className:"mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Pengguna"}),e("p",{className:"mt-1 text-sm text-gray-600",children:"Manajemen semua pengguna sistem"})]}),e(h,{onClick:Q,variant:"primary",icon:E,children:"Tambah Pengguna"})]}),s("div",{className:"relative w-full sm:w-64 mb-6",children:[e("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e(re,{className:"text-gray-400"})}),e("input",{type:"text",placeholder:"Cari nama/email...",value:C,onChange:L,className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 sm:text-sm"}),F&&e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:s("svg",{className:"animate-spin h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),!F&&C&&e("button",{type:"button",onClick:R,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e(te,{className:"text-gray-400 hover:text-gray-600"})})]}),e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:n.data.length===0?s("div",{className:"p-8 text-center",children:[e("div",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",children:e($,{className:"w-full h-full"})}),e("h3",{className:"text-lg font-medium text-gray-900",children:"Belum ada pengguna"}),e("p",{className:"mt-2 text-gray-500",children:"Tidak ada pengguna yang terdaftar sebagai peserta."})]}):s("div",{className:"overflow-x-auto",children:[s("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:s("tr",{children:[e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pengguna"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role & Kategori"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Informasi"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:n.data&&(n==null?void 0:n.data.map(a=>s(Z.Fragment,{children:[s("tr",{className:"hover:bg-gray-50 transition-colors",children:[e("td",{className:"px-6 py-4",children:s("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600",children:e($,{size:20})}),s("div",{className:"ml-4",children:[e("div",{className:"font-medium text-gray-900",children:a.name}),s("div",{className:"text-sm text-gray-500 flex items-center",children:[e(ne,{className:"mr-1",size:14}),a.email]})]})]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"flex items-center",children:[e(le,{className:"mr-2 text-green-500"}),e("span",{className:"font-medium",children:a.role.name})]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"text-sm text-gray-500 flex items-center",children:[e(ie,{className:"mr-2 text-gray-400"}),"Bergabung:"," ",H(a.created_at)]})}),e("td",{className:"px-6 py-4 text-right",children:s("div",{className:"flex justify-end space-x-2",children:[e("button",{onClick:()=>q(a.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Lihat Pendaftaran",children:e(D,{size:18})}),e("button",{onClick:()=>X(a),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Edit",children:e(j,{size:18})})]})})]}),_===a.id&&e("tr",{children:e("td",{colSpan:"4",className:"px-6 py-4 bg-gray-50",children:s("div",{className:"pl-14",children:[s("h4",{className:"font-medium text-gray-700 mb-3 flex items-center",children:[e(D,{className:"mr-2 text-green-500"}),"Pendaftaran Pengguna"]}),a.registrations&&a.registrations.length>0?e("div",{className:"space-y-3",children:a.registrations.map(t=>e("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:s("div",{className:"flex justify-between items-start",children:[s("div",{children:[e("h5",{className:"font-medium text-gray-900",children:t.competition.name}),e("p",{className:"text-sm text-gray-500",children:t.category.name})]}),s(ee,{href:`/super-admin/registrations/${t.id}`,className:"text-green-600 hover:text-green-800 flex items-center text-sm",children:[e(de,{className:"mr-1"}),"Lihat Detail"]})]})},t.id))}):e("p",{className:"text-gray-500 text-sm",children:"Pengguna belum memiliki pendaftaran"})]})})})]},a.id)))})]}),n.data.length>0&&s("div",{className:"px-6 py-4 bg-white border-t border-gray-200 flex items-center justify-between",children:[s("div",{className:"text-sm text-gray-700",children:["Menampilkan"," ",e("span",{className:"font-medium",children:n.from})," ","ke"," ",e("span",{className:"font-medium",children:n.to})," ","dari"," ",e("span",{className:"font-medium",children:n.total})," ","hasil"]}),s("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>g.get(n.prev_page_url),disabled:!n.prev_page_url,className:`px-3 py-1 rounded-md ${n.prev_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Sebelumnya"}),e("button",{onClick:()=>g.get(n.next_page_url),disabled:!n.next_page_url,className:`px-3 py-1 rounded-md ${n.next_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Selanjutnya"})]})]})]})})]})}),e(A,{show:I,onClose:()=>N(!1),title:"Konfirmasi Penghapusan",maxWidth:"lg",children:s("div",{className:"space-y-4",children:[e("p",{className:"text-gray-600",children:"Apakah Anda yakin ingin menghapus pengguna ini? Semua data terkait akan dihapus secara permanen. Tindakan ini tidak dapat dibatalkan."}),s("div",{className:"flex justify-end space-x-3 pt-2",children:[e(h,{onClick:()=>N(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:W,variant:"danger",size:"medium",icon:oe,children:"Ya, Hapus Pengguna"})]})]})}),e(A,{show:v,onClose:()=>p(!1),title:i?"Edit Pengguna":"Tambah Pengguna Baru",maxWidth:"2xl",children:s("div",{className:"space-y-4",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),e("input",{type:"text",name:"name",value:d.name,onChange:m,className:`w-full rounded-md border ${r.name?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.name&&e("p",{className:"mt-1 text-sm text-red-600",children:r.name})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e("input",{type:"email",name:"email",value:d.email,onChange:m,className:`w-full rounded-md border ${r.email?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.email&&e("p",{className:"mt-1 text-sm text-red-600",children:r.email})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),s("select",{name:"role_id",value:d.role_id,onChange:m,className:`w-full rounded-md border ${r.role_id?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`,children:[e("option",{value:"",children:"Pilih Role"}),M.map(a=>e("option",{value:a.id,children:a.name},a.id))]}),r.role_id&&e("p",{className:"mt-1 text-sm text-red-600",children:r.role_id})]}),!i&&s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${r.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.password&&e("p",{className:"mt-1 text-sm text-red-600",children:r.password})]}),!i&&s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${r.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:r.password_confirmation})]}),i&&s(ae,{children:[s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru (opsional)"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${r.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.password&&e("p",{className:"mt-1 text-sm text-red-600",children:r.password})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${r.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),r.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:r.password_confirmation})]})]})]}),d.role_id==2&&s("div",{className:"mt-4",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori yang Dikelola (hanya untuk Admin)"}),e("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:B.map(a=>s("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:`category-${a.id}`,value:a.id,checked:d.category_ids.includes(a.id),onChange:V,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e("label",{htmlFor:`category-${a.id}`,className:"ml-2 text-sm text-gray-700",children:a.name})]},a.id))}),r.category_ids&&e("p",{className:"mt-1 text-sm text-red-600",children:r.category_ids})]}),s("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 mt-6",children:[e(h,{onClick:()=>p(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:Y,variant:"primary",size:"medium",icon:i?j:E,children:i?"Update Pengguna":"Tambah Pengguna"})]})]})})]})}export{ve as default};
