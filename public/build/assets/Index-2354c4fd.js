import{X as ee,r as l,a as s,j as e,S as ae,R as se,x as te,A as p,F as re}from"./app-37a05af3.js";import{A as ne}from"./AuthenticatedLayout-b2ab0c87.js";import{o as E,F as le,q as ie,b as D,m as de,n as oe,u as ce,y as $,z as j,A as z,f as me}from"./index-ff3f98e8.js";import{M as A}from"./Modal-335fe1be.js";import{B as h}from"./Button-f9f9f8da.js";import"./Toater-9ddae612.js";import"./index-6f220d89.js";import"./proxy-fc1dcfeb.js";function ve({auth:ue}){const{users:n,roles:M,categories:I,filters:N}=ee().props,[B,x]=l.useState(!1),[v,g]=l.useState(!1),[i,w]=l.useState(!1),[c,k]=l.useState(null),[T,U]=l.useState(null),[_,K]=l.useState(null),[C,S]=l.useState((N==null?void 0:N.search)||""),[F,f]=l.useState(!1),[d,y]=l.useState({name:"",email:"",role_id:"",password:"",password_confirmation:"",category_ids:[]}),[t,P]=l.useState({});function L(a,r){let o;return function(...u){clearTimeout(o),o=setTimeout(()=>{a.apply(this,u)},r)}}const R=l.useCallback(L(a=>{p.get("/super-admin/users",{search:a},{preserveState:!0,replace:!0,onFinish:()=>f(!1)})},500),[]),H=a=>{const r=a.target.value;S(r),f(!0),R(r)},W=()=>{S(""),f(!0),p.get("/super-admin/users",{},{preserveState:!0,replace:!0,onFinish:()=>f(!1)})};l.useEffect(()=>{v||(y({name:"",email:"",role_id:"",password:"",password_confirmation:"",category_ids:[]}),P({}),w(!1),k(null))},[v]),l.useEffect(()=>{var a;i&&c&&y({name:c.name,email:c.email,role_id:c.role_id,password:"",password_confirmation:"",category_ids:((a=c.managedCategories)==null?void 0:a.map(r=>r.id))||[]})},[i,c]);const q=a=>{U(a),x(!0)},Q=()=>{p.delete(`/super-admin/users/${T}`,{preserveScroll:!0,onSuccess:()=>{x(!1)}})},X=a=>{K(_===a?null:a)},V=a=>{const r={year:"numeric",month:"long",day:"numeric"};return new Date(a).toLocaleDateString("id-ID",r)},Y=()=>{g(!0),w(!1)},G=a=>{k(a),w(!0),g(!0)},m=a=>{const{name:r,value:o}=a.target;y(u=>({...u,[r]:o}))},J=a=>{const{value:r,checked:o}=a.target;y(u=>{let b=[...u.category_ids];return o?b.push(parseInt(r)):b=b.filter(Z=>Z!==parseInt(r)),{...u,category_ids:b}})},O=()=>{const a=i?`/super-admin/users/${c.id}`:"/super-admin/users";p[i?"put":"post"](a,d,{preserveScroll:!0,onSuccess:()=>{g(!1)},onError:o=>{P(o)}})};return console.log(n),s(ne,{children:[e(ae,{title:"Kelola Pengguna"}),e("div",{className:"",children:s("div",{children:[s("div",{className:"mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Pengguna"}),e("p",{className:"mt-1 text-sm text-gray-600",children:"Manajemen semua pengguna sistem"})]}),e(h,{onClick:Y,variant:"primary",icon:E,children:"Tambah Pengguna"})]}),s("div",{className:"relative w-full sm:w-64 mb-6",children:[e("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e(le,{className:"text-gray-400"})}),e("input",{type:"text",placeholder:"Cari nama/email...",value:C,onChange:H,className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 sm:text-sm"}),F&&e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:s("svg",{className:"animate-spin h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),!F&&C&&e("button",{type:"button",onClick:W,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e(ie,{className:"text-gray-400 hover:text-gray-600"})})]}),e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:n.data.length===0?s("div",{className:"p-8 text-center",children:[e("div",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",children:e(D,{className:"w-full h-full"})}),e("h3",{className:"text-lg font-medium text-gray-900",children:"Belum ada pengguna"}),e("p",{className:"mt-2 text-gray-500",children:"Tidak ada pengguna yang terdaftar sebagai peserta."})]}):s("div",{className:"overflow-x-auto",children:[s("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:s("tr",{children:[e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pengguna"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role & Kategori"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Informasi"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:n.data&&(n==null?void 0:n.data.map(a=>s(se.Fragment,{children:[s("tr",{className:"hover:bg-gray-50 transition-colors",children:[e("td",{className:"px-6 py-4",children:s("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600",children:e(D,{size:20})}),s("div",{className:"ml-4",children:[e("div",{className:"font-medium text-gray-900",children:a.name}),s("div",{className:"text-sm text-gray-500 flex items-center",children:[e(de,{className:"mr-1",size:14}),a.email]})]})]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"flex items-center",children:[e(oe,{className:"mr-2 text-purple-500"}),e("span",{className:"font-medium",children:a.role.name})]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"text-sm text-gray-500 flex items-center",children:[e(ce,{className:"mr-2 text-gray-400"}),"Bergabung:"," ",V(a.created_at)]})}),e("td",{className:"px-6 py-4 text-right",children:s("div",{className:"flex justify-end space-x-2",children:[e("button",{onClick:()=>X(a.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Lihat Pendaftaran",children:e($,{size:18})}),e("button",{onClick:()=>G(a),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Edit",children:e(j,{size:18})}),e("button",{onClick:()=>q(a.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Hapus",children:e(z,{size:18})})]})})]}),_===a.id&&e("tr",{children:e("td",{colSpan:"4",className:"px-6 py-4 bg-gray-50",children:s("div",{className:"pl-14",children:[s("h4",{className:"font-medium text-gray-700 mb-3 flex items-center",children:[e($,{className:"mr-2 text-green-500"}),"Pendaftaran Pengguna"]}),a.registrations&&a.registrations.length>0?e("div",{className:"space-y-3",children:a.registrations.map(r=>e("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:s("div",{className:"flex justify-between items-start",children:[s("div",{children:[e("h5",{className:"font-medium text-gray-900",children:r.competition.name}),e("p",{className:"text-sm text-gray-500",children:r.category.name})]}),s(te,{href:`/admin/registrations/${r.id}`,className:"text-green-600 hover:text-green-800 flex items-center text-sm",children:[e(me,{className:"mr-1"}),"Lihat Detail"]})]})},r.id))}):e("p",{className:"text-gray-500 text-sm",children:"Pengguna belum memiliki pendaftaran"})]})})})]},a.id)))})]}),n.data.length>0&&s("div",{className:"px-6 py-4 bg-white border-t border-gray-200 flex items-center justify-between",children:[s("div",{className:"text-sm text-gray-700",children:["Menampilkan"," ",e("span",{className:"font-medium",children:n.from})," ","ke"," ",e("span",{className:"font-medium",children:n.to})," ","dari"," ",e("span",{className:"font-medium",children:n.total})," ","hasil"]}),s("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>p.get(n.prev_page_url),disabled:!n.prev_page_url,className:`px-3 py-1 rounded-md ${n.prev_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Sebelumnya"}),e("button",{onClick:()=>p.get(n.next_page_url),disabled:!n.next_page_url,className:`px-3 py-1 rounded-md ${n.next_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Selanjutnya"})]})]})]})})]})}),e(A,{show:B,onClose:()=>x(!1),title:"Konfirmasi Penghapusan",maxWidth:"lg",children:s("div",{className:"space-y-4",children:[e("p",{className:"text-gray-600",children:"Apakah Anda yakin ingin menghapus pengguna ini? Semua data terkait akan dihapus secara permanen. Tindakan ini tidak dapat dibatalkan."}),s("div",{className:"flex justify-end space-x-3 pt-2",children:[e(h,{onClick:()=>x(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:Q,variant:"danger",size:"medium",icon:z,children:"Ya, Hapus Pengguna"})]})]})}),e(A,{show:v,onClose:()=>g(!1),title:i?"Edit Pengguna":"Tambah Pengguna Baru",maxWidth:"2xl",children:s("div",{className:"space-y-4",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),e("input",{type:"text",name:"name",value:d.name,onChange:m,className:`w-full rounded-md border ${t.name?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.name&&e("p",{className:"mt-1 text-sm text-red-600",children:t.name})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e("input",{type:"email",name:"email",value:d.email,onChange:m,className:`w-full rounded-md border ${t.email?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.email&&e("p",{className:"mt-1 text-sm text-red-600",children:t.email})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),s("select",{name:"role_id",value:d.role_id,onChange:m,className:`w-full rounded-md border ${t.role_id?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`,children:[e("option",{value:"",children:"Pilih Role"}),M.map(a=>e("option",{value:a.id,children:a.name},a.id))]}),t.role_id&&e("p",{className:"mt-1 text-sm text-red-600",children:t.role_id})]}),!i&&s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${t.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),!i&&s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${t.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password_confirmation})]}),i&&s(re,{children:[s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru (opsional)"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${t.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),s("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${t.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password_confirmation})]})]})]}),d.role_id==2&&s("div",{className:"mt-4",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori yang Dikelola (hanya untuk Admin)"}),e("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:I.map(a=>s("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:`category-${a.id}`,value:a.id,checked:d.category_ids.includes(a.id),onChange:J,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e("label",{htmlFor:`category-${a.id}`,className:"ml-2 text-sm text-gray-700",children:a.name})]},a.id))}),t.category_ids&&e("p",{className:"mt-1 text-sm text-red-600",children:t.category_ids})]}),s("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 mt-6",children:[e(h,{onClick:()=>g(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:O,variant:"primary",size:"medium",icon:i?j:E,children:i?"Update Pengguna":"Tambah Pengguna"})]})]})})]})}export{ve as default};
