import{X as G,r as i,a,j as e,S as J,R as O,x as Z,A as g,F as ee}from"./app-856ffffb.js";import{A as ae}from"./AuthenticatedLayout-5f157725.js";import{s as E,F as se,u as te,c as D,q as re,r as ne,i as ie,B as $,C as j,f as le,D as de}from"./index-ba0f79a5.js";import{M as I}from"./Modal-41d77ba7.js";import{B as h}from"./Button-8a1f7b3d.js";import"./Toater-3ef5ddcd.js";import"./index-31b8bfa9.js";import"./index-fe3498a7.js";import"./proxy-538fca6d.js";function ve({auth:ce}){const{users:n,roles:oe,categories:M,filters:N}=G().props,[A,b]=i.useState(!1),[v,p]=i.useState(!1),[l,w]=i.useState(!1),[c,k]=i.useState(null),[B,me]=i.useState(null),[_,z]=i.useState(null),[C,S]=i.useState((N==null?void 0:N.search)||""),[F,x]=i.useState(!1),[d,f]=i.useState({name:"",email:"",role_id:"",password:"",password_confirmation:"",nik:"",category_ids:[]}),[t,P]=i.useState({});function T(s,r){let o;return function(...u){clearTimeout(o),o=setTimeout(()=>{s.apply(this,u)},r)}}const U=i.useCallback(T(s=>{g.get("/super-admin/users",{search:s},{preserveState:!0,replace:!0,onFinish:()=>x(!1)})},500),[]),K=s=>{const r=s.target.value;S(r),x(!0),U(r)},L=()=>{S(""),x(!0),g.get("/super-admin/users",{},{preserveState:!0,replace:!0,onFinish:()=>x(!1)})};i.useEffect(()=>{v||(f({name:"",email:"",role_id:"",password:"",password_confirmation:"",category_ids:[]}),P({}),w(!1),k(null))},[v]),i.useEffect(()=>{var s;l&&c&&f({name:c.name,email:c.email,role_id:c.role_id,nik:c.nik,password:"",password_confirmation:"",category_ids:((s=c.managedCategories)==null?void 0:s.map(r=>r.id))||[]})},[l,c]);const R=()=>{g.delete(`/super-admin/users/${B}`,{preserveScroll:!0,onSuccess:()=>{b(!1)}})},W=s=>{z(_===s?null:s)},q=s=>{const r={year:"numeric",month:"long",day:"numeric"};return new Date(s).toLocaleDateString("id-ID",r)},H=()=>{p(!0),w(!1)},Q=s=>{k(s),w(!0),p(!0)},m=s=>{const{name:r,value:o}=s.target;f(u=>({...u,[r]:o}))},X=s=>{const{value:r,checked:o}=s.target;f(u=>{let y=[...u.category_ids];return o?y.push(parseInt(r)):y=y.filter(Y=>Y!==parseInt(r)),{...u,category_ids:y}})},V=()=>{const s=l?`/super-admin/users/${c.id}`:"/super-admin/users";g[l?"put":"post"](s,d,{preserveScroll:!0,onSuccess:()=>{p(!1)},onError:o=>{P(o)}})};return a(ae,{children:[e(J,{title:"Kelola Pengguna"}),e("div",{className:"",children:a("div",{children:[a("div",{className:"mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Pengguna"}),e("p",{className:"mt-1 text-sm text-gray-600",children:"Manajemen semua pengguna sistem"})]}),e(h,{onClick:H,variant:"primary",icon:E,children:"Tambah Pengguna"})]}),a("div",{className:"relative w-full sm:w-64 mb-6",children:[e("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e(se,{className:"text-gray-400"})}),e("input",{type:"text",placeholder:"Cari nama/email...",value:C,onChange:K,className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 sm:text-sm"}),F&&e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:a("svg",{className:"animate-spin h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),!F&&C&&e("button",{type:"button",onClick:L,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e(te,{className:"text-gray-400 hover:text-gray-600"})})]}),e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:n.data.length===0?a("div",{className:"p-8 text-center",children:[e("div",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",children:e(D,{className:"w-full h-full"})}),e("h3",{className:"text-lg font-medium text-gray-900",children:"Belum ada pengguna"}),e("p",{className:"mt-2 text-gray-500",children:"Tidak ada pengguna yang terdaftar sebagai peserta."})]}):a("div",{className:"overflow-x-auto",children:[a("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:a("tr",{children:[e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pengguna"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role & Kategori"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Informasi"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:n.data&&(n==null?void 0:n.data.map(s=>a(O.Fragment,{children:[a("tr",{className:"hover:bg-gray-50 transition-colors",children:[e("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600",children:e(D,{size:20})}),a("div",{className:"ml-4",children:[e("div",{className:"font-medium text-gray-900",children:s.name}),a("div",{className:"text-sm text-gray-500 flex items-center",children:[e(re,{className:"mr-1",size:14}),s.email]})]})]})}),e("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center",children:[e(ne,{className:"mr-2 text-green-500"}),e("span",{className:"font-medium",children:s.role.name})]})}),e("td",{className:"px-6 py-4",children:a("div",{className:"text-sm text-gray-500 flex items-center",children:[e(ie,{className:"mr-2 text-gray-400"}),"Bergabung:"," ",q(s.created_at)]})}),e("td",{className:"px-6 py-4 text-right",children:a("div",{className:"flex justify-end space-x-2",children:[e("button",{onClick:()=>W(s.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Lihat Pendaftaran",children:e($,{size:18})}),e("button",{onClick:()=>Q(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Edit",children:e(j,{size:18})})]})})]}),_===s.id&&e("tr",{children:e("td",{colSpan:"4",className:"px-6 py-4 bg-gray-50",children:a("div",{className:"pl-14",children:[a("h4",{className:"font-medium text-gray-700 mb-3 flex items-center",children:[e($,{className:"mr-2 text-green-500"}),"Pendaftaran Pengguna"]}),s.registrations&&s.registrations.length>0?e("div",{className:"space-y-3",children:s.registrations.map(r=>e("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:a("div",{className:"flex justify-between items-start",children:[a("div",{children:[e("h5",{className:"font-medium text-gray-900",children:r.competition.name}),e("p",{className:"text-sm text-gray-500",children:r.category.name})]}),a(Z,{href:`/super-admin/registrations/${r.id}`,className:"text-green-600 hover:text-green-800 flex items-center text-sm",children:[e(le,{className:"mr-1"}),"Lihat Detail"]})]})},r.id))}):e("p",{className:"text-gray-500 text-sm",children:"Pengguna belum memiliki pendaftaran"})]})})})]},s.id)))})]}),n.data.length>0&&a("div",{className:"px-6 py-4 bg-white border-t border-gray-200 flex items-center justify-between",children:[a("div",{className:"text-sm text-gray-700",children:["Menampilkan"," ",e("span",{className:"font-medium",children:n.from})," ","ke"," ",e("span",{className:"font-medium",children:n.to})," ","dari"," ",e("span",{className:"font-medium",children:n.total})," ","hasil"]}),a("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>g.get(n.prev_page_url),disabled:!n.prev_page_url,className:`px-3 py-1 rounded-md ${n.prev_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Sebelumnya"}),e("button",{onClick:()=>g.get(n.next_page_url),disabled:!n.next_page_url,className:`px-3 py-1 rounded-md ${n.next_page_url?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 cursor-not-allowed"}`,children:"Selanjutnya"})]})]})]})})]})}),e(I,{show:A,onClose:()=>b(!1),title:"Konfirmasi Penghapusan",maxWidth:"lg",children:a("div",{className:"space-y-4",children:[e("p",{className:"text-gray-600",children:"Apakah Anda yakin ingin menghapus pengguna ini? Semua data terkait akan dihapus secara permanen. Tindakan ini tidak dapat dibatalkan."}),a("div",{className:"flex justify-end space-x-3 pt-2",children:[e(h,{onClick:()=>b(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:R,variant:"danger",size:"medium",icon:de,children:"Ya, Hapus Pengguna"})]})]})}),e(I,{show:v,onClose:()=>p(!1),title:l?"Edit Pengguna":"Tambah Pengguna Baru",maxWidth:"2xl",children:a("div",{className:"space-y-4",children:[a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),e("input",{type:"text",name:"name",value:d.name,onChange:m,className:`w-full rounded-md border ${t.name?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.name&&e("p",{className:"mt-1 text-sm text-red-600",children:t.name})]}),a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e("input",{type:"email",name:"email",value:d.email,onChange:m,className:`w-full rounded-md border ${t.email?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.email&&e("p",{className:"mt-1 text-sm text-red-600",children:t.email})]}),a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NIK"}),e("input",{type:"text",name:"nik",value:d.nik,onChange:m,className:`w-full rounded-md border ${t.nik?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.nik&&e("p",{className:"mt-1 text-sm text-red-600",children:t.nik})]}),!l&&a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${t.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),!l&&a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${t.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password_confirmation})]}),l&&a(ee,{children:[a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru (opsional)"}),e("input",{type:"password",name:"password",value:d.password,onChange:m,className:`w-full rounded-md border ${t.password?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),a("div",{className:"col-span-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),e("input",{type:"password",name:"password_confirmation",value:d.password_confirmation,onChange:m,className:`w-full rounded-md border ${t.password_confirmation?"border-red-500":"border-gray-300"} px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500`}),t.password_confirmation&&e("p",{className:"mt-1 text-sm text-red-600",children:t.password_confirmation})]})]})]}),d.role_id==2&&a("div",{className:"mt-4",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori yang Dikelola (hanya untuk Admin)"}),e("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:M.map(s=>a("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:`category-${s.id}`,value:s.id,checked:d.category_ids.includes(s.id),onChange:X,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e("label",{htmlFor:`category-${s.id}`,className:"ml-2 text-sm text-gray-700",children:s.name})]},s.id))}),t.category_ids&&e("p",{className:"mt-1 text-sm text-red-600",children:t.category_ids})]}),a("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 mt-6",children:[e(h,{onClick:()=>p(!1),variant:"secondary",size:"medium",children:"Batal"}),e(h,{onClick:V,variant:"primary",size:"medium",icon:l?j:E,children:l?"Update Pengguna":"Tambah Pengguna"})]})]})})]})}export{ve as default};
